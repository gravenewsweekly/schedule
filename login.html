!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScheduleCreate.com | Login</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="signup.html">Sign Up</a>
    </nav>

    <section>
        <h2>Log In to ScheduleCreate.com</h2>
        <p>Welcome back! Enter your credentials to access your personalized schedules.</p>

        <form id="loginForm">
            <div class="input-group">
                <input type="email" id="loginEmail" placeholder="Email" required>
            </div>
            <div class="input-group">
                <input type="password" id="loginPassword" placeholder="Password" required>
                <span id="togglePassword" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
            </div>
            <button type="submit">Log In</button>
        </form>

        <p id="errorMessage" style="color: red; display: none;"></p>
        <p>Don't have an account? <a href="signup.html">Sign Up</a></p>
        <p>Forgot password? <a href="#" id="forgotPassword">Reset here</a></p>
    </section>

    <footer>
        <p>¬© 2025 ScheduleCreate.com. All Rights Reserved.</p>
    </footer>

    <script>
        // Check if user is already logged in
        const loggedInUser = JSON.parse(localStorage.getItem("user"));
        if (loggedInUser) {
            window.location.href = "index.html"; // Redirect to home if already logged in
        }

        document.getElementById("loginForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            const email = document.getElementById("loginEmail").value.trim();
            const password = document.getElementById("loginPassword").value;
            const errorMessage = document.getElementById("errorMessage");

            // Basic client-side validation
            if (!email || !password) {
                errorMessage.innerText = "Please fill in all fields.";
                errorMessage.style.display = "block";
                return;
            }

            const apiKey = "$2a$10$ZNo5JVKUh6E5ICm.ezmotO8u4CVZc707uFxrkAamgPPMGDBHhXAWq";
            const binId = "67e1bb208960c979a577a15f";

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                    method: "GET",
                    headers: { "X-Master-Key": apiKey }
                });

                if (!response.ok) {
                    throw new Error("Failed to fetch user data. Please try again later.");
                }

                const data = await response.json();
                const users = Array.isArray(data.record) ? data.record : [data.record]; // Handle single user or array

                const user = users.find(u => u.email === email && u.password === password);

                if (user) {
                    localStorage.setItem("user", JSON.stringify(user));
                    window.location.href = "index.html";
                } else {
                    errorMessage.innerText = "Invalid email or password. Please try again.";
                    errorMessage.style.display = "block";
                }
            } catch (error) {
                errorMessage.innerText = error.message || "An error occurred. Please try again.";
                errorMessage.style.display = "block";
            }
        });

        // Toggle password visibility
        function togglePasswordVisibility() {
            const passwordField = document.getElementById("loginPassword");
            const toggleIcon = document.getElementById("togglePassword");
            if (passwordField.type === "password") {
                passwordField.type = "text";
                toggleIcon.textContent = "üôà";
            } else {
                passwordField.type = "password";
                toggleIcon.textContent = "üëÅÔ∏è";
            }
        }

        // Placeholder for forgot password (future feature)
        document.getElementById("forgotPassword").addEventListener("click", function(event) {
            event.preventDefault();
            alert("Password reset feature coming soon! Contact support@schedulecreate.com for now.");
        });
    </script>
</body>
</html>
